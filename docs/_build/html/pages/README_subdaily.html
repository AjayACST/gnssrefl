<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>subdaily &mdash; gnssrefl  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> gnssrefl
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to gnssrefl documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="understand.html">Understanding</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="func_and_utils_doc.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/modules.html">gnssrefl api reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_drivethru.html">gnssrefl use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="news.html">News <a name="news"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="news.html#bugs-features-a-name-bugs-a">Bugs/Features <a name="bugs"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="contributions_questions.html">Community and Questions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">gnssrefl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>subdaily<a name="module6"></a></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/pages/README_subdaily.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="subdaily-a-name-module6-a">
<h1>subdaily<a name="module6"></a><a class="headerlink" href="#subdaily-a-name-module6-a" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>This module is meant for RH measurements that have a subdaily component. It is not strictly
for water levels, but that is generally where it should be used. There are
two main goals for this code:</p>
<ul class="simple">
<li><p>consolidate daily result files and find/remove outliers</p></li>
<li><p>apply the <a class="reference external" href="https://www.kristinelarson.net/wp-content/uploads/2015/10/LarsonIEEE_2013.pdf">RHdot correction</a></p></li>
</ul>
<p>If you want to do your own QC, you can simply cat the files in your results area. As an example, after you have
run <code>gnssir</code> for a station called sc02 in the year 2021:</p>
<p><code>cat $REFL_CODE/2021/sc02/*.txt &gt;sc02.txt</code></p>
<p>If you would prefer to use our code, it is pretty straightforward. It has two sections.  The first
minimally requires the station name and year:</p>
<p><code>subdaily sc02 2021 </code></p>
<p>It picks up all result files from 2021, sorts and concatenates them. If you only want to
look at a subset of days, you can set -doy1 and/or -doy2. The output file location
is sent to the screen. <code>subdaily</code> then tries to remove large outliers
by using a standard deviation test. This can be controlled at the command line. Example figures:</p>
<p>Results are presented with azimuth and amplitude colors to help you modify QC choices or azimuth mask:</p>
<a class="reference internal image-reference" href="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-1.png"><img alt="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-1.png" src="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-1.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-2.png"><img alt="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-2.png" src="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-2.png" style="width: 600px;" /></a>
<p>Whle this code is meant to be used AFTER you have chosen an analysis strategy, you can
apply new azimuth and amplitude constraints on the commandline, <code>-azim1, azim2, ampl</code>.</p>
<p>The second section of <code>subdaily</code> is related to the RHdot correction. You must explicitly ask for it.
There are lots of ways to apply the RHdot correction - I am only providing a simple one at this point.<br />
The RHdot correction requires you know</p>
<ul class="simple">
<li><p>the average of the tangent of the elevation angle during an arc,</p></li>
<li><p>edot, elevation angle rate of change with respect to time)</p></li>
<li><p>RHdot (RH rate of change with respect to time)</p></li>
</ul>
<p>The first two are trivial to compute and are included in the results file in column 13 as the edotF.
This edot factor has units of rad/(rad/hour), or hours. So if you know RHdot in units of meters/hour,
you can get the correction by simple multiplication.</p>
<p>Computing RHdot is the trickiest part of calculating the RHdot correction.
And multiple papers have been written about it. If you have a
well-observed site (lots of arcs and minimal gaps), you can use the RH
data themselves to estimate a smooth model for RH (via cubic splines) and
then just back out RHdot. This is what is done in <code>subdaily</code> (if and only if you invoke -rhdot True).
It will also make a second effort to remove outliers.<br />
Note: if you have a site with a large RHdot correction, you should be cautious of removing too many
outliers in the first section of this code as this is really signal, not noise. You can set the outlier criterion
with <code>-spline_outlier N</code>, where N is in meters. It also makes an attempt to remove frequency biases.</p>
<p>There are other ways to compute the RHdot correction:</p>
<ul class="simple">
<li><p>computing tidal coefficients, and then iterating using the forward predictions of the tidal fit(Larson et al. 2013b)</p></li>
<li><p>estimating RHdot effect simultaneously with tidal coefficient (Larson et al. 2017).</p></li>
<li><p>low-order tidal fit (Lofgren et al 2014)</p></li>
<li><p>direct inversion of the SNR data (Strandberg et al 2016 , Purnell et al. 2021)</p></li>
<li><p>estimate a rate and an acceleration term (Tabibi et al 2020)</p></li>
</ul>
<p>I am working to make some of these other methods available in this package.</p>
<p>Here are some results from the SC02 site again - but now from the second section of the code.
In the bottom panel you can see that applying the RHdot correction at this site improves the
RMS fit from 0.15 to 0.11 meters.</p>
<a class="reference internal image-reference" href="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-3.png"><img alt="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-3.png" src="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-3.png" style="width: 600px;" /></a>
<p>After the RHdot correction has been applied, the code then estimates a new spline fit and
removes frequency-specific biases. Stats for this fit with respect to the spline fit
are printed to the screen. Three-sigma outliers with respect to the new fit are removed.
In this example the RMS improves from 0.11 to 0.09 m.</p>
<a class="reference internal image-reference" href="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-5.png"><img alt="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-5.png" src="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/sc02-5.png" style="width: 600px;" /></a>
<p>Here is an example of a site (TNPP) where the RHdot correction is
even more important (I apologize for color choice here. The
current code uses more color-blindness-friendly colors):</p>
<a class="reference internal image-reference" href="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/tnpp_rhdot2.png"><img alt="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/tnpp_rhdot2.png" src="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/tnpp_rhdot2.png" style="width: 600px;" /></a>
<p>After removing the RHdot effect and frequency biases, the RMS improves from 0.244 to 0.1 meters.</p>
<a class="reference internal image-reference" href="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/tnpp_final.png"><img alt="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/tnpp_final.png" src="https://github.com/kristinemlarson/gnssrefl/blob/master/docs/tnpp_final.png" style="width: 600px;" /></a>
<p>Comment: if you have an existing file with results, you can just run the second part of the code.
If the input file is called test.txt, you would call it as:</p>
<p><code>subdaily sc02 2021 -splinefile test.txt -rhdot True</code></p>
<hr>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Dr. Kristine Larson and UNAVCO.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>